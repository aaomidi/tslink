networks:
  tailnet:
    driver: ${PLUGIN_NAME:-ghcr.io/aaomidi/tslink}:${PLUGIN_TAG:-test}
    driver_opts:
      tslink.authkey: ${TS_AUTHKEY}

services:
  server:
    build: ./server
    networks:
      - tailnet
    labels:
      tslink.hostname: "${SERVER_HOSTNAME:-tslink-server}"
      tslink.direct: "true"
      tslink.serve.9999: "tcp:9998"
      tslink.service: "svc:tslink-test"

  client:
    build: ./client
    networks:
      - tailnet
    labels:
      tslink.hostname: "${CLIENT_HOSTNAME:-tslink-client}"
    dns:
      - 100.100.100.100
    dns_search:
      - ${TAILNET_SUFFIX:-atlas-diminished.ts.net}
    environment:
      - SERVER_HOSTNAME=${SERVER_HOSTNAME:-tslink-server}
      - STATIC_SERVICE=${STATIC_SERVICE:-tslink-test.atlas-diminished.ts.net}
      - TAILNET_SUFFIX=${TAILNET_SUFFIX:-atlas-diminished.ts.net}
    depends_on:
      - server
